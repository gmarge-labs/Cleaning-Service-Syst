// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String          @id
  email               String          @unique
  password            String
  name                String
  phone               String?
  address             String?         // Legacy field, keeping for compatibility
  role                Role            @default(CUSTOMER)
  notificationSettings Json?           // Store notification preferences
  addresses           Address[]
  paymentMethods      PaymentMethod[]
  bookings            Booking[]
  notifications       Notification[]
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
}

model Address {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  label     String   // e.g., "Home", "Office"
  street    String
  city      String
  state     String
  zip       String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PaymentMethod {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  type      String   // e.g., "Visa", "Mastercard"
  last4     String
  expiry    String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Booking {
  id                  String        @id
  userId              String?
  user                User?         @relation(fields: [userId], references: [id])
  
  // Guest Info (if not logged in)
  guestName           String?
  guestEmail          String?
  guestPhone          String?
  address             String?       // Added address field
  
  // Service Details
  serviceType         String
  propertyType        String
  bedrooms            Int?
  bathrooms           Int?
  toilets             Int?
  rooms               Json?         // Store rooms and quantities as JSON
  
  // Add-ons
  addOns              Json?         // Store add-ons as JSON
  kitchenAddOns       Json?         // Store kitchen-specific add-ons as JSON (kitchen index -> array of add-on IDs)
  laundryRoomDetails  Json?         // Store laundry room details as JSON (laundry index -> {baskets, rounds})
  
  // Scheduling
  date                DateTime
  time                String
  frequency           String
  specialInstructions String?
  
  // Pets
  hasPet              Boolean       @default(false)
  petDetails          Json?         // Store pet types and if pet is present
  
  // Payment
  paymentMethod       String?
  tipAmount           Decimal?      @default(0)
  totalAmount         Decimal
  
  // Duration and Staffing
  estimatedDuration   Int?          // Estimated duration in minutes
  cleanerCount        Int           @default(1)
  paymentPerHour      Decimal?
  toolsRequired       String?
  
  status              BookingStatus @default(PENDING)
  
  reviews             Review[]
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
}

model Review {
  id          String   @id @default(cuid())
  bookingId   String?
  booking     Booking? @relation(fields: [bookingId], references: [id])
  rating      Int
  comment     String
  status      ReviewStatus @default(PENDING)
  adminReply  String?
  repliedAt   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum ReviewStatus {
  PENDING
  PUBLISHED
  REJECTED
}

enum BookingStatus {
  DRAFT
  BOOKED
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum Role {
  CUSTOMER
  ADMIN
  SUPERVISOR
  SUPPORT
  CLEANER
}

model CleanerApplication {
  id                      String   @id @default(cuid())
  firstName               String
  lastName                String
  email                   String
  phone                   String
  dateOfBirth             DateTime
  gender                  String
  address                 String
  city                    String
  state                   String
  zipCode                 String?
  ssn                     String?
  idUrl                   String?
  reference1Name          String?
  reference1Phone         String?
  reference1Relationship  String?
  reference1RelationshipOther String?
  reference1Address       String?
  reference1City          String?
  reference1State         String?
  reference2Name          String?
  reference2Phone         String?
  reference2Relationship  String?
  reference2RelationshipOther String?
  reference2Address       String?
  reference2City          String?
  reference2State         String?
  status                  ApplicationStatus @default(PENDING)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  ACCEPTED
  REJECTED
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String   // e.g., "booking_created", "booking_confirmed", "review_received", "payment_received", "cleaner_application"
  title     String
  message   String
  data      Json?    // Store additional data like booking ID, user name, etc.
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([isRead])
}

model SystemSettings {
  id                String   @id @default("default")
  general           Json     // companyName, email, phone, address, businessHours, serviceArea
  pricing           Json     // depositPercentage, weeklyDiscount, biWeeklyDiscount, monthlyDiscount, cancellationFee
  cleanerPay        Json     // Cleaner hourly wages by level
  servicePrices     Json     // Standard Cleaning, Deep Cleaning, etc.
  roomPrices        Json     // Bedroom, Bathroom, etc.
  addonPrices       Json     // Inside Windows, Inside Fridge, etc.
  durationSettings  Json?    // Base minutes, minutes per room, multipliers
  integrations      Json     // stripe, plivo, sendgrid, etc.
  notifications     Json     // templates for emails/reminders
  updatedAt         DateTime @updatedAt
}

model InventoryItem {
  id                    String   @id @default(cuid())
  name                  String
  category              String
  purchaseUnit          String?
  quantityPurchased     Int?
  itemsPerPurchaseUnit  Int?
  baseUnit              String?
  pricePerPurchaseUnit  Decimal? @db.Decimal(10, 2)
  quantity              Int      // Total base units
  reorderThreshold      Int
  vendor                String?
  cost                  Decimal  @db.Decimal(10, 2) // Legacy/Total cost
  lastRestocked         DateTime @default(now())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

